<!DOCTYPE	html>	
<html>	
		<head>	
				<title>Build your first Machine Learning modek recognizing images</title>	
                <!-- Import TensorFlow.js -->
                <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
                <!-- Import tfjs-vis -->
                <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js"></script>
                <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>

                {% load static %}
                <script  type="module" src="{% static 'main.js' %}" type="text/javascript"></script>  
                {% load static %}
                <script  type="module" src="{% static 'target_class.js' %}" type="text/javascript"></script>  
                

</head>
		</head>	
		<body>
            <b><h1> 1. Creation of the Algorithm </h1></b>
            <p color="red"> PLEASE CHOOSE YOUR ACCOUNT, THAT WILL BE FIXED ASAP :) </p>
            <form action="." method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{form_ML.as_p}}
                <button type="submit" class="btn btn-lg btn-success">
                    Create algorithm
                </button>
                </form>
                <body>
                    <b><h1> 2. Collection of labellized data that our algorithm will use </h1></b>
                    <b><h2> 2.1 Enter your first pictures labelised </h2></b>
                    <form action="." method="post" enctype="multipart/form-data" >
                        {% csrf_token %}
                        <p> Insert your algorithm name :</p>
                        <select name="ml_name">
                            <option selected="selected" disabled>Objects on page:</option>
                            {% for ml_name in ml_names %}
                                <option value="{{ ml_name }}">{{ ml_name }}</option>
                            {% endfor %}
                            </select>
                        <p> Insert label of your first image category : <input type="text" name="label"/> </p>
                         <p> Drop all your files : <input required name="images" type="file" multiple > </p>
                        <b><h2> 2.2 Enter your second pictures labelised </h2></b>
                        <p> Insert Label of your second image category <input type="text" name="label2"/> </p>
                        <p> Drop all your files  <input required name="images2" type="file" multiple > </p>
                        <button class="btn btn-primary" type="submit">Upload</button>
                      </form> <br> 
                      <b><h1> 3. Training of the machine Learning model </h1></b>
                      <form action="." method="post" enctype="multipart/form-data" >
                        {% csrf_token %}
                      <p> Insert the name of the algorithm you want to train : <input type="text" name="ml_name_train"/> </p>
                      <button class="btn btn-primary" type="submit">Train the model </button>
                    </form> <br> 
                    <b><h1> 4. First prediction of your machine Learning model!! </h1></b>
                    <div id='password' style="display:none;">{{ password }}</div>
                    <div id='list_label' style="display:none;">{{ list_label }}</div>

                    <main role="main" class="container mt-5">
                        <div class="row">
                            <div class="col-12">
                                <div class="progress progress-bar progress-bar-striped progress-bar-animated mb-2">Model is not yet loaded ...</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <input id="image-selector" class="form-control border-0" type="file">
                            </div>
                            <div class="col-6">
                                <button id="predict-button" class="btn btn-primary float-right">Predict</button>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6">
                                <h2 class="ml-3">Image</h2>
                                <img id="selected-image" class="ml-3" width="250" alt=""> 
                            </div>
                            <div class="col-6">
                                <h2 class="ml-3">Predictions</h2>
                                <ol id="prediction-list"></ol>
                            </div>
                        </div>
                    </main>
                    <!-- <main>
                        <section class="image-section">
                          <img src="" id="image" />
                        </section>
                      
                        <section class="file-section">
                          <div class="file-group">
                            <label for="file-input">Upload a picture</label>
                            <input type="file" id="file-input" />
                          </div>
                        </section>
                      </main> -->
            <!-- <form action="." method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{form_Image.as_p}}
                <button type="submit" class="btn btn-lg btn-success">Upload</button>
                </form>
                {% if obj %}
                <h3>Succesfully uploaded : {{img_obj.caption}}</h3>
                <img src="{{ obj.image.url}}" alt="image" class="img-thumbnail" >
                {% endif %}
                <hr> -->
                <!-- <script>
                    // ici je vais faire l'import de mon modèle tensorflow qui est du coup codé en python, l'import ici dans le js va me permettre de faire les prédictions en temps réel dans le browser j'imagine.
    
                    //finalement juste le fichier json ça permet de tout faire, sinon je me mets un vilain json dans la base de donnée haha
                    const MODEL_URL = 'MLApp/ML_algo/converted_model/model.json';
                    const model = await loadGraphModel(MODEL_URL); -->
                    <!-- </script> -->

                    <!-- <script>
                        // Define a model for linear regression.
                        const model = tf.sequential();
                        model.add(tf.layers.dense({units: 1, inputShape: [1]}));
                        
                        model.compile({loss: 'meanSquaredError', optimizer: 'sgd'});
                        
                        // Generate some synthetic data for training.
                        const xs = tf.tensor2d([1, 2, 3, 4], [4, 1]);
                        const ys = tf.tensor2d([1, 3, 5, 7], [4, 1]);
                        
                        // Train the model using the data.
                        model.fit(xs, ys, {epochs: 10}).then(() => {
                           // Use the model to do inference on a data point the model hasn't seen before:
                        model.predict(tf.tensor2d([5], [1, 1])).print();
                           // Open the browser devtools to see the output
                           // C'est incroyable j'ai mon modèle qui est là.
                         });
                        </script> -->

                        <!-- <script>
                            // Specify location of our Model.json file we uploaded to the Glitch.com CDN.
                            const MODEL_URL = 'https://capture-static.s3.ca-central-1.amazonaws.com/models/model.json';
                            async function run() {
                                // Load the model from the CDN.
                                const model = await tf.loadLayersModel(MODEL_URL);
                                
                                // Print out the architecture of the loaded model.
                                // This is useful to see that it matches what we built in Python.
                                console.log(model.summary());

                                const fileInput = document.getElementById("file-input");
                                const image = document.getElementById("image");

                                function getImage() {
                                // Check if an image has been found in the input
                                if (!fileInput.files[0]) throw new Error("Image not found");
                                const file = fileInput.files[0];
                                const reader = new FileReader();

                                const image = new Image();
                                image.src = dataUrl;
                                reader.onload = function (event) {
                                    image.setAttribute("src", event.target.result);
                                    document.body.classList.add("image-loaded");
                                };
                                // Get data url
                                reader.readAsDataURL(file);
                                }
                                /**
                                 * When user uploads a new image, display the new image on the webpage
                                 */
                                fileInput.addEventListener("change", getImage);
                                function classifyImage() {
                                    const image_ready = tf.browser.fromPixels(image)
                                    model.predict(image_ready)
                                    console.log("Predictions: ");
                                    console.log(predictions);
                                };
                                classifyImage();
                 
        }

                            run();
                            
                        </script> -->
		</body>	

</html>